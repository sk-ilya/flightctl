<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Documentation for FlightCtl - Fleet management for edge devices"><link href=https://flightctl.github.io/flightctl/developer/service-quadlets/ rel=canonical><link href=../metrics/ rel=prev><link href=../architecture/ rel=next><link rel=icon href=../../assets/images/favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.6.15"><title>Service Quadlets - FlightCtl Documentation</title><link rel=stylesheet href=../../assets/stylesheets/main.342714a4.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.06af60db.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#flight-control-service-quadlets class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--shadow md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title="FlightCtl Documentation" class="md-header__button md-logo" aria-label="FlightCtl Documentation" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> FlightCtl Documentation </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Service Quadlets </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media=(prefers-color-scheme) data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to light mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=blue data-md-color-accent=blue aria-label="Switch to dark mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=blue data-md-color-accent=blue aria-label="Switch to system preference" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to system preference" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" title=Share aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/flightctl/flightctl title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </div> <div class=md-source__repository> flightctl/flightctl </div> </a> </div> </nav> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../../user/ class=md-tabs__link> User Guide </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=../ class=md-tabs__link> Developer Guide </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title="FlightCtl Documentation" class="md-nav__button md-logo" aria-label="FlightCtl Documentation" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> FlightCtl Documentation </label> <div class=md-nav__source> <a href=https://github.com/flightctl/flightctl title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </div> <div class=md-source__repository> flightctl/flightctl </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> <span class=md-ellipsis> Home </span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../user/ class=md-nav__link> <span class=md-ellipsis> User Guide </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3 checked> <div class="md-nav__link md-nav__container"> <a href=../ class="md-nav__link "> <span class=md-ellipsis> Developer Guide </span> </a> <label class="md-nav__link " for=__nav_3 id=__nav_3_label tabindex> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=true> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Developer Guide </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../devicesimulator/ class=md-nav__link> <span class=md-ellipsis> Device Simulator </span> </a> </li> <li class=md-nav__item> <a href=../metrics/ class=md-nav__link> <span class=md-ellipsis> Metrics </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> Service Quadlets </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> Service Quadlets </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#overview class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class=md-nav__item> <a href=#what-are-quadlets class=md-nav__link> <span class=md-ellipsis> What are Quadlets? </span> </a> </li> <li class=md-nav__item> <a href=#flight-control-service-architecture class=md-nav__link> <span class=md-ellipsis> Flight Control Service Architecture </span> </a> <nav class=md-nav aria-label="Flight Control Service Architecture"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#service-dependencies class=md-nav__link> <span class=md-ellipsis> Service Dependencies </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#configuration-management class=md-nav__link> <span class=md-ellipsis> Configuration Management </span> </a> <nav class=md-nav aria-label="Configuration Management"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#global-configuration class=md-nav__link> <span class=md-ellipsis> Global Configuration </span> </a> </li> <li class=md-nav__item> <a href=#service-configuration class=md-nav__link> <span class=md-ellipsis> Service Configuration </span> </a> <nav class=md-nav aria-label="Service Configuration"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#static-configuration class=md-nav__link> <span class=md-ellipsis> Static Configuration </span> </a> </li> <li class=md-nav__item> <a href=#dynamic-configuration class=md-nav__link> <span class=md-ellipsis> Dynamic Configuration </span> </a> </li> <li class=md-nav__item> <a href=#secrets class=md-nav__link> <span class=md-ellipsis> Secrets </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#local-deployment class=md-nav__link> <span class=md-ellipsis> Local Deployment </span> </a> <nav class=md-nav aria-label="Local Deployment"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#deployment-flow class=md-nav__link> <span class=md-ellipsis> Deployment Flow </span> </a> <nav class=md-nav aria-label="Deployment Flow"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#installation class=md-nav__link> <span class=md-ellipsis> Installation </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#cleanup class=md-nav__link> <span class=md-ellipsis> Cleanup </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#service-management class=md-nav__link> <span class=md-ellipsis> Service Management </span> </a> <nav class=md-nav aria-label="Service Management"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#startingstopping-services class=md-nav__link> <span class=md-ellipsis> Starting/Stopping Services </span> </a> </li> <li class=md-nav__item> <a href=#viewing-logs class=md-nav__link> <span class=md-ellipsis> Viewing Logs </span> </a> </li> <li class=md-nav__item> <a href=#container-management class=md-nav__link> <span class=md-ellipsis> Container Management </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#rpm-installation-and-deployment class=md-nav__link> <span class=md-ellipsis> RPM Installation and Deployment </span> </a> </li> <li class=md-nav__item> <a href=#contributing-adding-a-new-quadlet class=md-nav__link> <span class=md-ellipsis> Contributing: Adding a New Quadlet </span> </a> <nav class=md-nav aria-label="Contributing: Adding a New Quadlet"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1-create-service-directory class=md-nav__link> <span class=md-ellipsis> 1. Create Service Directory </span> </a> </li> <li class=md-nav__item> <a href=#2-create-container-quadlet class=md-nav__link> <span class=md-ellipsis> 2. Create Container Quadlet </span> </a> </li> <li class=md-nav__item> <a href=#3-setup-configuration-optional class=md-nav__link> <span class=md-ellipsis> 3. Setup Configuration (Optional) </span> </a> <nav class=md-nav aria-label="3. Setup Configuration (Optional)"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#static-configuration_1 class=md-nav__link> <span class=md-ellipsis> Static Configuration </span> </a> </li> <li class=md-nav__item> <a href=#dynamic-configuration_1 class=md-nav__link> <span class=md-ellipsis> Dynamic Configuration </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#4-add-volume-if-needed class=md-nav__link> <span class=md-ellipsis> 4. Add Volume (If Needed) </span> </a> </li> <li class=md-nav__item> <a href=#5-update-install-scripting class=md-nav__link> <span class=md-ellipsis> 5. Update Install Scripting </span> </a> </li> <li class=md-nav__item> <a href=#6-update-target-file class=md-nav__link> <span class=md-ellipsis> 6. Update Target File </span> </a> </li> <li class=md-nav__item> <a href=#7-test-your-service class=md-nav__link> <span class=md-ellipsis> 7. Test Your Service </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#contributing-updating-the-rpm class=md-nav__link> <span class=md-ellipsis> Contributing: Updating the RPM </span> </a> <nav class=md-nav aria-label="Contributing: Updating the RPM"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1-update-the-files-services-section class=md-nav__link> <span class=md-ellipsis> 1. Update the %files services Section </span> </a> </li> <li class=md-nav__item> <a href=#2-test-rpm-build class=md-nav__link> <span class=md-ellipsis> 2. Test RPM Build </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_3_5> <div class="md-nav__link md-nav__container"> <a href=../architecture/ class="md-nav__link "> <span class=md-ellipsis> Architecture </span> </a> <label class="md-nav__link " for=__nav_3_5 id=__nav_3_5_label tabindex> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_5_label aria-expanded=false> <label class=md-nav__title for=__nav_3_5> <span class="md-nav__icon md-icon"></span> Architecture </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../architecture/architecture/ class=md-nav__link> <span class=md-ellipsis> System Architecture </span> </a> </li> <li class=md-nav__item> <a href=../architecture/tasks/ class=md-nav__link> <span class=md-ellipsis> Tasks </span> </a> </li> <li class=md-nav__item> <a href=../architecture/field-selectors/ class=md-nav__link> <span class=md-ellipsis> Field Selectors </span> </a> </li> <li class=md-nav__item> <a href=../architecture/alerts/ class=md-nav__link> <span class=md-ellipsis> Alerts </span> </a> </li> <li class=md-nav__item> <a href=../architecture/rollout-device-selection/ class=md-nav__link> <span class=md-ellipsis> Rollout Device Selection </span> </a> </li> <li class=md-nav__item> <a href=../architecture/rollout-disruption-budget/ class=md-nav__link> <span class=md-ellipsis> Rollout Disruption Budget </span> </a> </li> <li class=md-nav__item> <a href=../architecture/service-observability/ class=md-nav__link> <span class=md-ellipsis> Service Observability </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_3_6> <div class="md-nav__link md-nav__container"> <a href=../enhancements/ class="md-nav__link "> <span class=md-ellipsis> Enhancements </span> </a> <label class="md-nav__link " for=__nav_3_6 id=__nav_3_6_label tabindex> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_6_label aria-expanded=false> <label class=md-nav__title for=__nav_3_6> <span class="md-nav__icon md-icon"></span> Enhancements </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../enhancements/fep-000-api-device-fleet/ class=md-nav__link> <span class=md-ellipsis> FEP-000 API Device Fleet </span> </a> </li> <li class=md-nav__item> <a href=../enhancements/fep-002-remote-console/ class=md-nav__link> <span class=md-ellipsis> FEP-002 Remote Console </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#overview class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class=md-nav__item> <a href=#what-are-quadlets class=md-nav__link> <span class=md-ellipsis> What are Quadlets? </span> </a> </li> <li class=md-nav__item> <a href=#flight-control-service-architecture class=md-nav__link> <span class=md-ellipsis> Flight Control Service Architecture </span> </a> <nav class=md-nav aria-label="Flight Control Service Architecture"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#service-dependencies class=md-nav__link> <span class=md-ellipsis> Service Dependencies </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#configuration-management class=md-nav__link> <span class=md-ellipsis> Configuration Management </span> </a> <nav class=md-nav aria-label="Configuration Management"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#global-configuration class=md-nav__link> <span class=md-ellipsis> Global Configuration </span> </a> </li> <li class=md-nav__item> <a href=#service-configuration class=md-nav__link> <span class=md-ellipsis> Service Configuration </span> </a> <nav class=md-nav aria-label="Service Configuration"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#static-configuration class=md-nav__link> <span class=md-ellipsis> Static Configuration </span> </a> </li> <li class=md-nav__item> <a href=#dynamic-configuration class=md-nav__link> <span class=md-ellipsis> Dynamic Configuration </span> </a> </li> <li class=md-nav__item> <a href=#secrets class=md-nav__link> <span class=md-ellipsis> Secrets </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#local-deployment class=md-nav__link> <span class=md-ellipsis> Local Deployment </span> </a> <nav class=md-nav aria-label="Local Deployment"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#deployment-flow class=md-nav__link> <span class=md-ellipsis> Deployment Flow </span> </a> <nav class=md-nav aria-label="Deployment Flow"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#installation class=md-nav__link> <span class=md-ellipsis> Installation </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#cleanup class=md-nav__link> <span class=md-ellipsis> Cleanup </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#service-management class=md-nav__link> <span class=md-ellipsis> Service Management </span> </a> <nav class=md-nav aria-label="Service Management"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#startingstopping-services class=md-nav__link> <span class=md-ellipsis> Starting/Stopping Services </span> </a> </li> <li class=md-nav__item> <a href=#viewing-logs class=md-nav__link> <span class=md-ellipsis> Viewing Logs </span> </a> </li> <li class=md-nav__item> <a href=#container-management class=md-nav__link> <span class=md-ellipsis> Container Management </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#rpm-installation-and-deployment class=md-nav__link> <span class=md-ellipsis> RPM Installation and Deployment </span> </a> </li> <li class=md-nav__item> <a href=#contributing-adding-a-new-quadlet class=md-nav__link> <span class=md-ellipsis> Contributing: Adding a New Quadlet </span> </a> <nav class=md-nav aria-label="Contributing: Adding a New Quadlet"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1-create-service-directory class=md-nav__link> <span class=md-ellipsis> 1. Create Service Directory </span> </a> </li> <li class=md-nav__item> <a href=#2-create-container-quadlet class=md-nav__link> <span class=md-ellipsis> 2. Create Container Quadlet </span> </a> </li> <li class=md-nav__item> <a href=#3-setup-configuration-optional class=md-nav__link> <span class=md-ellipsis> 3. Setup Configuration (Optional) </span> </a> <nav class=md-nav aria-label="3. Setup Configuration (Optional)"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#static-configuration_1 class=md-nav__link> <span class=md-ellipsis> Static Configuration </span> </a> </li> <li class=md-nav__item> <a href=#dynamic-configuration_1 class=md-nav__link> <span class=md-ellipsis> Dynamic Configuration </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#4-add-volume-if-needed class=md-nav__link> <span class=md-ellipsis> 4. Add Volume (If Needed) </span> </a> </li> <li class=md-nav__item> <a href=#5-update-install-scripting class=md-nav__link> <span class=md-ellipsis> 5. Update Install Scripting </span> </a> </li> <li class=md-nav__item> <a href=#6-update-target-file class=md-nav__link> <span class=md-ellipsis> 6. Update Target File </span> </a> </li> <li class=md-nav__item> <a href=#7-test-your-service class=md-nav__link> <span class=md-ellipsis> 7. Test Your Service </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#contributing-updating-the-rpm class=md-nav__link> <span class=md-ellipsis> Contributing: Updating the RPM </span> </a> <nav class=md-nav aria-label="Contributing: Updating the RPM"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1-update-the-files-services-section class=md-nav__link> <span class=md-ellipsis> 1. Update the %files services Section </span> </a> </li> <li class=md-nav__item> <a href=#2-test-rpm-build class=md-nav__link> <span class=md-ellipsis> 2. Test RPM Build </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/flightctl/flightctl/edit/master/docs/developer/service-quadlets.md title="Edit this page" class="md-content__button md-icon" rel=edit> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75z"/></svg> </a> <a href=https://github.com/flightctl/flightctl/raw/master/docs/developer/service-quadlets.md title="View source of this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0 8a5 5 0 0 1-5-5 5 5 0 0 1 5-5 5 5 0 0 1 5 5 5 5 0 0 1-5 5m0-12.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5"/></svg> </a> <h1 id=flight-control-service-quadlets>Flight Control service Quadlets<a class=headerlink href=#flight-control-service-quadlets title="Permanent link">&para;</a></h1> <h2 id=overview>Overview<a class=headerlink href=#overview title="Permanent link">&para;</a></h2> <p>Flight Control services can be deployed as systemd-managed container Quadlets, providing a declarative way to manage containerized services using native systemd tooling.</p> <h2 id=what-are-quadlets>What are Quadlets?<a class=headerlink href=#what-are-quadlets title="Permanent link">&para;</a></h2> <p>Quadlets are a systemd feature that allows you to define containerized services using systemd unit files. Instead of running containers manually with <code>podman run</code>, you define the container configuration in a <code>.container</code> file that systemd can manage directly.</p> <p>A Quadlet file uses the systemd unit file format with container-specific directives:</p> <div class="language-ini highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=k>[Unit]</span>
</span><span id=__span-0-2><a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a><span class=na>Description</span><span class=o>=</span><span class=s>A containerized service</span>
</span><span id=__span-0-3><a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a>
</span><span id=__span-0-4><a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a><span class=k>[Container]</span>
</span><span id=__span-0-5><a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a><span class=na>ContainerName</span><span class=o>=</span><span class=s>some-service</span>
</span><span id=__span-0-6><a id=__codelineno-0-6 name=__codelineno-0-6 href=#__codelineno-0-6></a><span class=na>Image</span><span class=o>=</span><span class=s>quay.io/some-org/some-service:1.0.0</span>
</span></code></pre></div> <p>When systemd processes this file, it automatically generates the appropriate service unit and manages the container lifecycle.</p> <p>More info about systemd units using Podman Quadlet including definitions of fields available in the <code>.container</code> files can be found in the <a href=https://docs.podman.io/en/latest/markdown/podman-systemd.unit.5.html>Podman systemd documentation</a></p> <blockquote> <p><strong>Note</strong> Flight Control Quadlets are configured to run rootful containers and rootless is not supported</p> </blockquote> <h2 id=flight-control-service-architecture>Flight Control Service Architecture<a class=headerlink href=#flight-control-service-architecture title="Permanent link">&para;</a></h2> <p>The Flight Control Quadlets are organized in the <code>deploy/podman/</code> directory with the following general structure:</p> <div class="language-text highlight"><pre><span></span><code><span id=__span-1-1><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a>deploy/podman/
</span><span id=__span-1-2><a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a>├── flightctl-api/                      # Directory for each service
</span><span id=__span-1-3><a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a>│   ├── flightctl-api.container         # API service definition
</span><span id=__span-1-4><a id=__codelineno-1-4 name=__codelineno-1-4 href=#__codelineno-1-4></a>│   ├── flightctl-api-init.container    # Init container to manage creating application configuration
</span><span id=__span-1-5><a id=__codelineno-1-5 name=__codelineno-1-5 href=#__codelineno-1-5></a>│   └── flightctl-api-config/           # Configuration templates and scripts
</span><span id=__span-1-6><a id=__codelineno-1-6 name=__codelineno-1-6 href=#__codelineno-1-6></a>...
</span><span id=__span-1-7><a id=__codelineno-1-7 name=__codelineno-1-7 href=#__codelineno-1-7></a>├── flightctl.network                   # Container network definition
</span><span id=__span-1-8><a id=__codelineno-1-8 name=__codelineno-1-8 href=#__codelineno-1-8></a>├── flightctl.target                    # Service group definition
</span><span id=__span-1-9><a id=__codelineno-1-9 name=__codelineno-1-9 href=#__codelineno-1-9></a>└── service-config.yaml                 # Global configuration template
</span></code></pre></div> <h3 id=service-dependencies>Service Dependencies<a class=headerlink href=#service-dependencies title="Permanent link">&para;</a></h3> <p>Services are configured with proper startup ordering through systemd dependencies:</p> <div class="language-ini highlight"><pre><span></span><code><span id=__span-2-1><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a><span class=k>[Unit]</span>
</span><span id=__span-2-2><a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a><span class=na>After</span><span class=o>=</span><span class=s>flightctl-db.service flightctl-kv.service</span>
</span><span id=__span-2-3><a id=__codelineno-2-3 name=__codelineno-2-3 href=#__codelineno-2-3></a><span class=na>Requires</span><span class=o>=</span><span class=s>flightctl-db.service flightctl-kv.service</span>
</span></code></pre></div> <p>The dependency graph is configured between the individual <code>.container</code> files.</p> <h2 id=configuration-management>Configuration Management<a class=headerlink href=#configuration-management title="Permanent link">&para;</a></h2> <h3 id=global-configuration>Global Configuration<a class=headerlink href=#global-configuration title="Permanent link">&para;</a></h3> <p>All services share a common configuration file <code>service-config.yaml</code>:</p> <div class="language-yaml highlight"><pre><span></span><code><span id=__span-3-1><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a><span class=nt>global</span><span class=p>:</span>
</span><span id=__span-3-2><a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a><span class=w>  </span><span class=nt>baseDomain</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">example.com</span>
</span><span id=__span-3-3><a id=__codelineno-3-3 name=__codelineno-3-3 href=#__codelineno-3-3></a><span class=w>  </span><span class=nt>auth</span><span class=p>:</span>
</span><span id=__span-3-4><a id=__codelineno-3-4 name=__codelineno-3-4 href=#__codelineno-3-4></a><span class=w>    </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">none</span><span class=w> </span><span class=c1># aap, oidc or none</span>
</span><span id=__span-3-5><a id=__codelineno-3-5 name=__codelineno-3-5 href=#__codelineno-3-5></a><span class=w>    </span><span class=nt>insecureSkipTlsVerify</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
</span><span id=__span-3-6><a id=__codelineno-3-6 name=__codelineno-3-6 href=#__codelineno-3-6></a><span class=w>    </span><span class=nt>aap</span><span class=p>:</span>
</span><span id=__span-3-7><a id=__codelineno-3-7 name=__codelineno-3-7 href=#__codelineno-3-7></a><span class=w>      </span><span class=nt>apiUrl</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">https://aap.example.com</span>
</span><span id=__span-3-8><a id=__codelineno-3-8 name=__codelineno-3-8 href=#__codelineno-3-8></a><span class=w>      </span><span class=c1># ... other AAP settings</span>
</span><span id=__span-3-9><a id=__codelineno-3-9 name=__codelineno-3-9 href=#__codelineno-3-9></a><span class=w>    </span><span class=nt>oidc</span><span class=p>:</span>
</span><span id=__span-3-10><a id=__codelineno-3-10 name=__codelineno-3-10 href=#__codelineno-3-10></a><span class=w>      </span><span class=nt>oidcAuthority</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">https://oidc.example.com</span>
</span><span id=__span-3-11><a id=__codelineno-3-11 name=__codelineno-3-11 href=#__codelineno-3-11></a><span class=w>      </span><span class=c1># ... other OIDC settings</span>
</span></code></pre></div> <h3 id=service-configuration>Service Configuration<a class=headerlink href=#service-configuration title="Permanent link">&para;</a></h3> <p>Services have configuration requirements such as files or env variables they need to run. The config can largely be broken down into two buckets:</p> <ol> <li>Static configuration - Files that are the same for all instances of a service</li> <li>Dynamic configuration - Files that must be rendered based upon installation specific state or user provided config</li> </ol> <p>An example configuration directory for a service looks like:</p> <div class="language-text highlight"><pre><span></span><code><span id=__span-4-1><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a>deploy/podman/
</span><span id=__span-4-2><a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a>├── flightctl-service-name/                      # Directory for each service
</span><span id=__span-4-3><a id=__codelineno-4-3 name=__codelineno-4-3 href=#__codelineno-4-3></a>│   └── flightctl-service-name-config/           # Configuration templates and scripts
</span><span id=__span-4-4><a id=__codelineno-4-4 name=__codelineno-4-4 href=#__codelineno-4-4></a>|       ├── env.template                         # Template for env variables the service needs
</span><span id=__span-4-5><a id=__codelineno-4-5 name=__codelineno-4-5 href=#__codelineno-4-5></a>|       ├── config.ini                           # Static .ini file for configuring the service
</span><span id=__span-4-6><a id=__codelineno-4-6 name=__codelineno-4-6 href=#__codelineno-4-6></a>|       └── init.sh                              # Script that is run by the init-container
</span></code></pre></div> <h4 id=static-configuration>Static Configuration<a class=headerlink href=#static-configuration title="Permanent link">&para;</a></h4> <p>Services such as <code>flightctl-kv</code> have static files like a <code>redis.conf</code> used for any running instances of the service. The .conf file is installed to a standardized location (more on this further below) then referenced in the <code>.container</code> file like</p> <div class="language-ini highlight"><pre><span></span><code><span id=__span-5-1><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a><span class=na>Volume</span><span class=o>=</span><span class=s>/usr/share/flightctl/flightctl-kv/redis.conf:/usr/local/etc/redis/redis.conf</span>
</span></code></pre></div> <h4 id=dynamic-configuration>Dynamic Configuration<a class=headerlink href=#dynamic-configuration title="Permanent link">&para;</a></h4> <p>Many services use init containers to template configuration files before the main service starts. These init containers run configuration scripts, overlay values into rendered configuration the associated service needs, and are configured to run before the main service container starts.</p> <p>For example <code>flightctl-api</code> makes use of an init container to load values from the global <code>service-config.yaml</code> file and apply them to a <code>config.yaml</code> and an env file for populating variables needed by the service. The resulting configuration is consumed like:</p> <div class="language-ini highlight"><pre><span></span><code><span id=__span-6-1><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a><span class=c1># Load env variables written by the init service</span>
</span><span id=__span-6-2><a id=__codelineno-6-2 name=__codelineno-6-2 href=#__codelineno-6-2></a><span class=na>EnvironmentFile</span><span class=o>=</span><span class=s>/etc/flightctl/flightctl-api/env</span>
</span><span id=__span-6-3><a id=__codelineno-6-3 name=__codelineno-6-3 href=#__codelineno-6-3></a><span class=c1># Load config.yaml written by the init service</span>
</span><span id=__span-6-4><a id=__codelineno-6-4 name=__codelineno-6-4 href=#__codelineno-6-4></a><span class=na>Volume</span><span class=o>=</span><span class=s>/etc/flightctl/flightctl-api/config.yaml:/root/.flightctl/config.yaml:ro,z</span>
</span></code></pre></div> <h4 id=secrets>Secrets<a class=headerlink href=#secrets title="Permanent link">&para;</a></h4> <p>A subset of sensitive data is managed through Podman secrets:</p> <div class="language-ini highlight"><pre><span></span><code><span id=__span-7-1><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a><span class=k>[Container]</span>
</span><span id=__span-7-2><a id=__codelineno-7-2 name=__codelineno-7-2 href=#__codelineno-7-2></a><span class=na>Secret</span><span class=o>=</span><span class=s>flightctl-postgresql-master-password,type=env,target=DB_PASSWORD</span>
</span></code></pre></div> <p>Secrets are automatically generated during deployment and injected as environment variables to the running containers.</p> <h2 id=local-deployment>Local Deployment<a class=headerlink href=#local-deployment title="Permanent link">&para;</a></h2> <p>Deploy all services:</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-8-1><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a>make<span class=w> </span>deploy-quadlets
</span></code></pre></div> <p>Deploy individual services:</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-9-1><a id=__codelineno-9-1 name=__codelineno-9-1 href=#__codelineno-9-1></a>make<span class=w> </span>deploy-db
</span><span id=__span-9-2><a id=__codelineno-9-2 name=__codelineno-9-2 href=#__codelineno-9-2></a>make<span class=w> </span>deploy-kv
</span></code></pre></div> <blockquote> <p><strong>NOTE</strong> Deploying individual services makes use of service-name-standalone.container files The -standalone files are handled as a special case and currently used for integration testing </p> </blockquote> <h3 id=deployment-flow>Deployment Flow<a class=headerlink href=#deployment-flow title="Permanent link">&para;</a></h3> <p>At a high level running <code>make deploy-quadlets</code> performs the following steps:</p> <ol> <li>Installs files in appropriate locations</li> <li>Generates underlying systemd units and config by running <code>systemctl daemon-reload</code></li> <li>Starts a <code>flightctl.target</code> systemd target that spins up all the services</li> </ol> <h4 id=installation>Installation<a class=headerlink href=#installation title="Permanent link">&para;</a></h4> <p>Install in the context of the <code>make deploy-quadlets</code> involves taking files found in the Flight Control repository and moving them to various directories on the host system. The directories in question are:</p> <ol> <li>A configuration directory intended for read-only use - namely predefined config files or scripts that should not be editable<ul> <li><code>/usr/share/flightctl/</code></li> </ul> </li> <li>A configuration directory intended for dynamic use and populated by init containers and containing application state generated by the running services.<ul> <li><code>/etc/flightctl/</code></li> </ul> </li> <li>A systemd directory where <code>.container</code> files should be placed so that systemd will generate the underlying units appropriately.<ul> <li><code>/usr/share/containers/systemd/</code></li> </ul> </li> <li>A systemd directory where native systemd (e.g. the <code>flightctl.target</code> file) should be placed<ul> <li><code>/usr/lib/systemd/system</code></li> </ul> </li> </ol> <h3 id=cleanup>Cleanup<a class=headerlink href=#cleanup title="Permanent link">&para;</a></h3> <p>Remove all services and data:</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-10-1><a id=__codelineno-10-1 name=__codelineno-10-1 href=#__codelineno-10-1></a>make<span class=w> </span>clean-quadlets
</span></code></pre></div> <p>This stops services, removes configuration files, deletes volumes, and cleans up secrets.</p> <h2 id=service-management>Service Management<a class=headerlink href=#service-management title="Permanent link">&para;</a></h2> <h3 id=startingstopping-services>Starting/Stopping Services<a class=headerlink href=#startingstopping-services title="Permanent link">&para;</a></h3> <div class="language-bash highlight"><pre><span></span><code><span id=__span-11-1><a id=__codelineno-11-1 name=__codelineno-11-1 href=#__codelineno-11-1></a><span class=c1># Start all services</span>
</span><span id=__span-11-2><a id=__codelineno-11-2 name=__codelineno-11-2 href=#__codelineno-11-2></a>sudo<span class=w> </span>systemctl<span class=w> </span>start<span class=w> </span>flightctl.target
</span><span id=__span-11-3><a id=__codelineno-11-3 name=__codelineno-11-3 href=#__codelineno-11-3></a>
</span><span id=__span-11-4><a id=__codelineno-11-4 name=__codelineno-11-4 href=#__codelineno-11-4></a><span class=c1># Stop all services</span>
</span><span id=__span-11-5><a id=__codelineno-11-5 name=__codelineno-11-5 href=#__codelineno-11-5></a>sudo<span class=w> </span>systemctl<span class=w> </span>stop<span class=w> </span>flightctl.target
</span><span id=__span-11-6><a id=__codelineno-11-6 name=__codelineno-11-6 href=#__codelineno-11-6></a>
</span><span id=__span-11-7><a id=__codelineno-11-7 name=__codelineno-11-7 href=#__codelineno-11-7></a><span class=c1># Restart individual service</span>
</span><span id=__span-11-8><a id=__codelineno-11-8 name=__codelineno-11-8 href=#__codelineno-11-8></a>sudo<span class=w> </span>systemctl<span class=w> </span>restart<span class=w> </span>flightctl-api.service
</span><span id=__span-11-9><a id=__codelineno-11-9 name=__codelineno-11-9 href=#__codelineno-11-9></a>
</span><span id=__span-11-10><a id=__codelineno-11-10 name=__codelineno-11-10 href=#__codelineno-11-10></a><span class=c1># Check service status</span>
</span><span id=__span-11-11><a id=__codelineno-11-11 name=__codelineno-11-11 href=#__codelineno-11-11></a>sudo<span class=w> </span>systemctl<span class=w> </span>status<span class=w> </span>flightctl-api.service
</span></code></pre></div> <h3 id=viewing-logs>Viewing Logs<a class=headerlink href=#viewing-logs title="Permanent link">&para;</a></h3> <div class="language-bash highlight"><pre><span></span><code><span id=__span-12-1><a id=__codelineno-12-1 name=__codelineno-12-1 href=#__codelineno-12-1></a><span class=c1># View API service logs</span>
</span><span id=__span-12-2><a id=__codelineno-12-2 name=__codelineno-12-2 href=#__codelineno-12-2></a>sudo<span class=w> </span>journalctl<span class=w> </span>-u<span class=w> </span>flightctl-api.service<span class=w> </span>-f
</span><span id=__span-12-3><a id=__codelineno-12-3 name=__codelineno-12-3 href=#__codelineno-12-3></a>
</span><span id=__span-12-4><a id=__codelineno-12-4 name=__codelineno-12-4 href=#__codelineno-12-4></a><span class=c1># View all Flight Control logs</span>
</span><span id=__span-12-5><a id=__codelineno-12-5 name=__codelineno-12-5 href=#__codelineno-12-5></a>sudo<span class=w> </span>journalctl<span class=w> </span>-u<span class=w> </span><span class=s2>&quot;flightctl-*&quot;</span><span class=w> </span>-f
</span></code></pre></div> <p>The <code>--no-pager</code> option can also be helpful to wrap text depending on terminal settings.</p> <h3 id=container-management>Container Management<a class=headerlink href=#container-management title="Permanent link">&para;</a></h3> <div class="language-bash highlight"><pre><span></span><code><span id=__span-13-1><a id=__codelineno-13-1 name=__codelineno-13-1 href=#__codelineno-13-1></a><span class=c1># List running containers</span>
</span><span id=__span-13-2><a id=__codelineno-13-2 name=__codelineno-13-2 href=#__codelineno-13-2></a>sudo<span class=w> </span>podman<span class=w> </span>ps
</span><span id=__span-13-3><a id=__codelineno-13-3 name=__codelineno-13-3 href=#__codelineno-13-3></a>
</span><span id=__span-13-4><a id=__codelineno-13-4 name=__codelineno-13-4 href=#__codelineno-13-4></a><span class=c1># Execute command in container</span>
</span><span id=__span-13-5><a id=__codelineno-13-5 name=__codelineno-13-5 href=#__codelineno-13-5></a>sudo<span class=w> </span>podman<span class=w> </span><span class=nb>exec</span><span class=w> </span>-it<span class=w> </span>flightctl-api<span class=w> </span>ls
</span><span id=__span-13-6><a id=__codelineno-13-6 name=__codelineno-13-6 href=#__codelineno-13-6></a>
</span><span id=__span-13-7><a id=__codelineno-13-7 name=__codelineno-13-7 href=#__codelineno-13-7></a><span class=c1># View container logs</span>
</span><span id=__span-13-8><a id=__codelineno-13-8 name=__codelineno-13-8 href=#__codelineno-13-8></a>sudo<span class=w> </span>podman<span class=w> </span>logs<span class=w> </span>flightctl-api
</span></code></pre></div> <h2 id=rpm-installation-and-deployment>RPM Installation and Deployment<a class=headerlink href=#rpm-installation-and-deployment title="Permanent link">&para;</a></h2> <p>The service Quadlets are also available to install via an RPM. Installation steps for the latest release:</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-14-1><a id=__codelineno-14-1 name=__codelineno-14-1 href=#__codelineno-14-1></a>sudo<span class=w> </span>dnf<span class=w> </span>copr<span class=w> </span><span class=nb>enable</span><span class=w> </span>-y<span class=w> </span>@redhat-et/flightctl
</span><span id=__span-14-2><a id=__codelineno-14-2 name=__codelineno-14-2 href=#__codelineno-14-2></a>sudo<span class=w> </span>dnf<span class=w> </span>install<span class=w> </span>-y<span class=w> </span>flightctl-services
</span><span id=__span-14-3><a id=__codelineno-14-3 name=__codelineno-14-3 href=#__codelineno-14-3></a>sudo<span class=w> </span>systemctl<span class=w> </span>start<span class=w> </span>flightctl.target
</span><span id=__span-14-4><a id=__codelineno-14-4 name=__codelineno-14-4 href=#__codelineno-14-4></a>sudo<span class=w> </span>systemctl<span class=w> </span><span class=nb>enable</span><span class=w> </span>flightctl.target<span class=w> </span><span class=c1># To enable starting on reboot</span>
</span></code></pre></div> <h2 id=contributing-adding-a-new-quadlet>Contributing: Adding a New Quadlet<a class=headerlink href=#contributing-adding-a-new-quadlet title="Permanent link">&para;</a></h2> <p>Follow these steps to add a new service to the Flight Control Quadlets:</p> <h3 id=1-create-service-directory>1. Create Service Directory<a class=headerlink href=#1-create-service-directory title="Permanent link">&para;</a></h3> <div class="language-bash highlight"><pre><span></span><code><span id=__span-15-1><a id=__codelineno-15-1 name=__codelineno-15-1 href=#__codelineno-15-1></a>mkdir<span class=w> </span>-p<span class=w> </span>deploy/podman/flightctl-myservice/flightctl-myservice-config
</span></code></pre></div> <h3 id=2-create-container-quadlet>2. Create Container Quadlet<a class=headerlink href=#2-create-container-quadlet title="Permanent link">&para;</a></h3> <p>Create <code>deploy/podman/flightctl-myservice/flightctl-myservice.container</code>:</p> <div class="language-ini highlight"><pre><span></span><code><span id=__span-16-1><a id=__codelineno-16-1 name=__codelineno-16-1 href=#__codelineno-16-1></a><span class=k>[Unit]</span>
</span><span id=__span-16-2><a id=__codelineno-16-2 name=__codelineno-16-2 href=#__codelineno-16-2></a><span class=na>Description</span><span class=o>=</span><span class=s>Flight Control My Service</span>
</span><span id=__span-16-3><a id=__codelineno-16-3 name=__codelineno-16-3 href=#__codelineno-16-3></a><span class=na>PartOf</span><span class=o>=</span><span class=s>flightctl.target</span>
</span><span id=__span-16-4><a id=__codelineno-16-4 name=__codelineno-16-4 href=#__codelineno-16-4></a><span class=c1># Update After= and Requires= as needed for your needs</span>
</span><span id=__span-16-5><a id=__codelineno-16-5 name=__codelineno-16-5 href=#__codelineno-16-5></a><span class=na>After</span><span class=o>=</span>
</span><span id=__span-16-6><a id=__codelineno-16-6 name=__codelineno-16-6 href=#__codelineno-16-6></a><span class=na>Requires</span><span class=o>=</span>
</span><span id=__span-16-7><a id=__codelineno-16-7 name=__codelineno-16-7 href=#__codelineno-16-7></a>
</span><span id=__span-16-8><a id=__codelineno-16-8 name=__codelineno-16-8 href=#__codelineno-16-8></a><span class=k>[Container]</span>
</span><span id=__span-16-9><a id=__codelineno-16-9 name=__codelineno-16-9 href=#__codelineno-16-9></a><span class=na>ContainerName</span><span class=o>=</span><span class=s>flightctl-myservice</span>
</span><span id=__span-16-10><a id=__codelineno-16-10 name=__codelineno-16-10 href=#__codelineno-16-10></a><span class=na>Image</span><span class=o>=</span><span class=s>quay.io/flightctl/flightctl-myservice:latest</span>
</span><span id=__span-16-11><a id=__codelineno-16-11 name=__codelineno-16-11 href=#__codelineno-16-11></a><span class=na>Network</span><span class=o>=</span><span class=s>flightctl.network</span>
</span><span id=__span-16-12><a id=__codelineno-16-12 name=__codelineno-16-12 href=#__codelineno-16-12></a><span class=c1># !Important!</span>
</span><span id=__span-16-13><a id=__codelineno-16-13 name=__codelineno-16-13 href=#__codelineno-16-13></a><span class=c1># Because the containers are run using rootful podman host port definitions</span>
</span><span id=__span-16-14><a id=__codelineno-16-14 name=__codelineno-16-14 href=#__codelineno-16-14></a><span class=c1># will by default will automatically bypass configured firewalls and expose the port to the outside world.</span>
</span><span id=__span-16-15><a id=__codelineno-16-15 name=__codelineno-16-15 href=#__codelineno-16-15></a><span class=c1># See https://access.redhat.com/solutions/7081860</span>
</span><span id=__span-16-16><a id=__codelineno-16-16 name=__codelineno-16-16 href=#__codelineno-16-16></a><span class=na>PublishPort</span><span class=o>=</span><span class=s>8080:8080</span>
</span><span id=__span-16-17><a id=__codelineno-16-17 name=__codelineno-16-17 href=#__codelineno-16-17></a>
</span><span id=__span-16-18><a id=__codelineno-16-18 name=__codelineno-16-18 href=#__codelineno-16-18></a><span class=c1># Add Volume / Secret / EnvironmentFile definitions as needed</span>
</span><span id=__span-16-19><a id=__codelineno-16-19 name=__codelineno-16-19 href=#__codelineno-16-19></a><span class=na>Volume</span><span class=o>=</span><span class=s>/etc/flightctl/flightctl-myservice/config.yaml:/root/.flightctl/config.yaml:ro,z</span>
</span><span id=__span-16-20><a id=__codelineno-16-20 name=__codelineno-16-20 href=#__codelineno-16-20></a><span class=na>Secret</span><span class=o>=</span><span class=s>flightctl-postgresql-master-password,type=env,target=DB_PASSWORD</span>
</span><span id=__span-16-21><a id=__codelineno-16-21 name=__codelineno-16-21 href=#__codelineno-16-21></a><span class=na>EnvironmentFile</span><span class=o>=</span><span class=s>/etc/flightctl/flightctl-myservice/env</span>
</span><span id=__span-16-22><a id=__codelineno-16-22 name=__codelineno-16-22 href=#__codelineno-16-22></a>
</span><span id=__span-16-23><a id=__codelineno-16-23 name=__codelineno-16-23 href=#__codelineno-16-23></a><span class=k>[Service]</span>
</span><span id=__span-16-24><a id=__codelineno-16-24 name=__codelineno-16-24 href=#__codelineno-16-24></a><span class=na>Restart</span><span class=o>=</span><span class=s>always</span>
</span><span id=__span-16-25><a id=__codelineno-16-25 name=__codelineno-16-25 href=#__codelineno-16-25></a><span class=na>RestartSec</span><span class=o>=</span><span class=s>30</span>
</span><span id=__span-16-26><a id=__codelineno-16-26 name=__codelineno-16-26 href=#__codelineno-16-26></a>
</span><span id=__span-16-27><a id=__codelineno-16-27 name=__codelineno-16-27 href=#__codelineno-16-27></a><span class=k>[Install]</span>
</span><span id=__span-16-28><a id=__codelineno-16-28 name=__codelineno-16-28 href=#__codelineno-16-28></a><span class=na>WantedBy</span><span class=o>=</span><span class=s>flightctl.target</span>
</span></code></pre></div> <h3 id=3-setup-configuration-optional>3. Setup Configuration (Optional)<a class=headerlink href=#3-setup-configuration-optional title="Permanent link">&para;</a></h3> <h4 id=static-configuration_1>Static Configuration<a class=headerlink href=#static-configuration_1 title="Permanent link">&para;</a></h4> <p>Add files to a <code>deploy/podman/flightctl-myservice/flightctl-myservice-config</code> directory.</p> <h4 id=dynamic-configuration_1>Dynamic Configuration<a class=headerlink href=#dynamic-configuration_1 title="Permanent link">&para;</a></h4> <p>Add a template to a <code>deploy/podman/flightctl-myservice/flightctl-myservice-config</code> directory.</p> <p><strong><code>deploy/podman/flightctl-myservice/flightctl-myservice-config/config.yaml.template</code></strong>:</p> <div class="language-yaml highlight"><pre><span></span><code><span id=__span-17-1><a id=__codelineno-17-1 name=__codelineno-17-1 href=#__codelineno-17-1></a><span class=nt>database</span><span class=p>:</span>
</span><span id=__span-17-2><a id=__codelineno-17-2 name=__codelineno-17-2 href=#__codelineno-17-2></a><span class=w>  </span><span class=nt>hostname</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">flightctl-db</span>
</span><span id=__span-17-3><a id=__codelineno-17-3 name=__codelineno-17-3 href=#__codelineno-17-3></a><span class=w>  </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">5432</span>
</span><span id=__span-17-4><a id=__codelineno-17-4 name=__codelineno-17-4 href=#__codelineno-17-4></a><span class=nt>service</span><span class=p>:</span>
</span><span id=__span-17-5><a id=__codelineno-17-5 name=__codelineno-17-5 href=#__codelineno-17-5></a><span class=w>  </span><span class=nt>baseUrl</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">https://{{BASE_DOMAIN}}:8080/</span>
</span></code></pre></div> <p>Then write an <code>init.sh</code> file to also place in <code>deploy/podman/flightctl-myservice/flightctl-myservice-config</code>. <strong><code>deploy/podman/flightctl-myservice/flightctl-myservice-config/init.sh</code></strong>:</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-18-1><a id=__codelineno-18-1 name=__codelineno-18-1 href=#__codelineno-18-1></a><span class=ch>#!/usr/bin/env bash</span>
</span><span id=__span-18-2><a id=__codelineno-18-2 name=__codelineno-18-2 href=#__codelineno-18-2></a><span class=nb>set</span><span class=w> </span>-eo<span class=w> </span>pipefail
</span><span id=__span-18-3><a id=__codelineno-18-3 name=__codelineno-18-3 href=#__codelineno-18-3></a>
</span><span id=__span-18-4><a id=__codelineno-18-4 name=__codelineno-18-4 href=#__codelineno-18-4></a><span class=nb>source</span><span class=w> </span><span class=s2>&quot;/utils/init_utils.sh&quot;</span>
</span><span id=__span-18-5><a id=__codelineno-18-5 name=__codelineno-18-5 href=#__codelineno-18-5></a>
</span><span id=__span-18-6><a id=__codelineno-18-6 name=__codelineno-18-6 href=#__codelineno-18-6></a><span class=c1># Write service specific initialization logic as needed</span>
</span></code></pre></div> <p>Create <code>deploy/podman/flightctl-myservice/flightctl-myservice-init.container</code>:</p> <div class="language-ini highlight"><pre><span></span><code><span id=__span-19-1><a id=__codelineno-19-1 name=__codelineno-19-1 href=#__codelineno-19-1></a><span class=k>[Unit]</span>
</span><span id=__span-19-2><a id=__codelineno-19-2 name=__codelineno-19-2 href=#__codelineno-19-2></a><span class=na>PartOf</span><span class=o>=</span><span class=s>flightctl.target</span>
</span><span id=__span-19-3><a id=__codelineno-19-3 name=__codelineno-19-3 href=#__codelineno-19-3></a><span class=na>After</span><span class=o>=</span><span class=s>flightctl-db.service</span>
</span><span id=__span-19-4><a id=__codelineno-19-4 name=__codelineno-19-4 href=#__codelineno-19-4></a><span class=na>Wants</span><span class=o>=</span><span class=s>flightctl-db.service</span>
</span><span id=__span-19-5><a id=__codelineno-19-5 name=__codelineno-19-5 href=#__codelineno-19-5></a>
</span><span id=__span-19-6><a id=__codelineno-19-6 name=__codelineno-19-6 href=#__codelineno-19-6></a><span class=k>[Container]</span>
</span><span id=__span-19-7><a id=__codelineno-19-7 name=__codelineno-19-7 href=#__codelineno-19-7></a><span class=na>Image</span><span class=o>=</span><span class=s>registry.access.redhat.com/ubi9/ubi-minimal</span>
</span><span id=__span-19-8><a id=__codelineno-19-8 name=__codelineno-19-8 href=#__codelineno-19-8></a><span class=na>ContainerName</span><span class=o>=</span><span class=s>flightctl-myservice-init</span>
</span><span id=__span-19-9><a id=__codelineno-19-9 name=__codelineno-19-9 href=#__codelineno-19-9></a><span class=na>Network</span><span class=o>=</span><span class=s>flightctl.network</span>
</span><span id=__span-19-10><a id=__codelineno-19-10 name=__codelineno-19-10 href=#__codelineno-19-10></a><span class=na>Volume</span><span class=o>=</span><span class=s>/usr/share/flightctl/flightctl-myservice:/config-source:ro,z</span>
</span><span id=__span-19-11><a id=__codelineno-19-11 name=__codelineno-19-11 href=#__codelineno-19-11></a><span class=na>Volume</span><span class=o>=</span><span class=s>/usr/share/flightctl/init_utils.sh:/utils/init_utils.sh:ro,z</span>
</span><span id=__span-19-12><a id=__codelineno-19-12 name=__codelineno-19-12 href=#__codelineno-19-12></a><span class=na>Volume</span><span class=o>=</span><span class=s>/etc/flightctl/flightctl-myservice:/config-destination:rw,z</span>
</span><span id=__span-19-13><a id=__codelineno-19-13 name=__codelineno-19-13 href=#__codelineno-19-13></a><span class=na>Volume</span><span class=o>=</span><span class=s>/etc/flightctl/service-config.yaml:/service-config.yaml:ro,z</span>
</span><span id=__span-19-14><a id=__codelineno-19-14 name=__codelineno-19-14 href=#__codelineno-19-14></a><span class=na>Exec</span><span class=o>=</span><span class=s>/bin/sh /config-source/init.sh</span>
</span><span id=__span-19-15><a id=__codelineno-19-15 name=__codelineno-19-15 href=#__codelineno-19-15></a>
</span><span id=__span-19-16><a id=__codelineno-19-16 name=__codelineno-19-16 href=#__codelineno-19-16></a><span class=k>[Service]</span>
</span><span id=__span-19-17><a id=__codelineno-19-17 name=__codelineno-19-17 href=#__codelineno-19-17></a><span class=na>Type</span><span class=o>=</span><span class=s>oneshot</span>
</span><span id=__span-19-18><a id=__codelineno-19-18 name=__codelineno-19-18 href=#__codelineno-19-18></a><span class=na>RemainAfterExit</span><span class=o>=</span><span class=s>true</span>
</span><span id=__span-19-19><a id=__codelineno-19-19 name=__codelineno-19-19 href=#__codelineno-19-19></a><span class=na>Restart</span><span class=o>=</span><span class=s>on-failure</span>
</span><span id=__span-19-20><a id=__codelineno-19-20 name=__codelineno-19-20 href=#__codelineno-19-20></a><span class=na>RestartSec</span><span class=o>=</span><span class=s>5s</span>
</span><span id=__span-19-21><a id=__codelineno-19-21 name=__codelineno-19-21 href=#__codelineno-19-21></a>
</span><span id=__span-19-22><a id=__codelineno-19-22 name=__codelineno-19-22 href=#__codelineno-19-22></a><span class=k>[Install]</span>
</span><span id=__span-19-23><a id=__codelineno-19-23 name=__codelineno-19-23 href=#__codelineno-19-23></a><span class=na>WantedBy</span><span class=o>=</span><span class=s>flightctl.target</span>
</span></code></pre></div> <h3 id=4-add-volume-if-needed>4. Add Volume (If Needed)<a class=headerlink href=#4-add-volume-if-needed title="Permanent link">&para;</a></h3> <p>Create <code>deploy/podman/flightctl-myservice/flightctl-myservice.volume</code>:</p> <div class="language-ini highlight"><pre><span></span><code><span id=__span-20-1><a id=__codelineno-20-1 name=__codelineno-20-1 href=#__codelineno-20-1></a><span class=k>[Volume]</span>
</span><span id=__span-20-2><a id=__codelineno-20-2 name=__codelineno-20-2 href=#__codelineno-20-2></a><span class=na>VolumeName</span><span class=o>=</span><span class=s>flightctl-myservice</span>
</span></code></pre></div> <h3 id=5-update-install-scripting>5. Update Install Scripting<a class=headerlink href=#5-update-install-scripting title="Permanent link">&para;</a></h3> <p>Edit <code>deploy/scripts/install.sh</code> to include your service in the <code>render_files()</code> function:</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-21-1><a id=__codelineno-21-1 name=__codelineno-21-1 href=#__codelineno-21-1></a>render_files<span class=o>()</span><span class=w> </span><span class=o>{</span>
</span><span id=__span-21-2><a id=__codelineno-21-2 name=__codelineno-21-2 href=#__codelineno-21-2></a><span class=w>    </span><span class=c1># ... existing services ...</span>
</span><span id=__span-21-3><a id=__codelineno-21-3 name=__codelineno-21-3 href=#__codelineno-21-3></a><span class=w>    </span>render_service<span class=w> </span><span class=s2>&quot;myservice&quot;</span><span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>SOURCE_DIR</span><span class=si>}</span><span class=s2>&quot;</span>
</span><span id=__span-21-4><a id=__codelineno-21-4 name=__codelineno-21-4 href=#__codelineno-21-4></a><span class=w>    </span><span class=c1># ... rest of function ...</span>
</span><span id=__span-21-5><a id=__codelineno-21-5 name=__codelineno-21-5 href=#__codelineno-21-5></a>
</span><span id=__span-21-6><a id=__codelineno-21-6 name=__codelineno-21-6 href=#__codelineno-21-6></a><span class=w>    </span><span class=c1># If the service writes config ensure the location where those files are placed exists</span>
</span><span id=__span-21-7><a id=__codelineno-21-7 name=__codelineno-21-7 href=#__codelineno-21-7></a><span class=w>    </span>mkdir<span class=w> </span>-p<span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>CONFIG_WRITEABLE_DIR</span><span class=si>}</span><span class=s2>/flightctl-cli-artifacts&quot;</span>
</span><span id=__span-21-8><a id=__codelineno-21-8 name=__codelineno-21-8 href=#__codelineno-21-8></a><span class=o>}</span>
</span></code></pre></div> <p>Edit <code>deploy/scripts/deploy_quadlets.sh</code> so the polling waits for the new service to spin up.</p> <p>If your service creates volume or other artifacts, edit <code>deploy/scripts/clean_quadlets.sh</code> so they are properly removed.</p> <h3 id=6-update-target-file>6. Update Target File<a class=headerlink href=#6-update-target-file title="Permanent link">&para;</a></h3> <p>Edit <code>deploy/podman/flightctl.target</code> to include your service:</p> <div class="language-ini highlight"><pre><span></span><code><span id=__span-22-1><a id=__codelineno-22-1 name=__codelineno-22-1 href=#__codelineno-22-1></a><span class=k>[Unit]</span>
</span><span id=__span-22-2><a id=__codelineno-22-2 name=__codelineno-22-2 href=#__codelineno-22-2></a><span class=c1># ... existing content ...</span>
</span><span id=__span-22-3><a id=__codelineno-22-3 name=__codelineno-22-3 href=#__codelineno-22-3></a><span class=na>Requires</span><span class=o>=</span><span class=s>flightctl-myservice.service</span>
</span><span id=__span-22-4><a id=__codelineno-22-4 name=__codelineno-22-4 href=#__codelineno-22-4></a>
</span><span id=__span-22-5><a id=__codelineno-22-5 name=__codelineno-22-5 href=#__codelineno-22-5></a><span class=na>After</span><span class=o>=</span><span class=s>flightctl-myservice.service</span>
</span></code></pre></div> <h3 id=7-test-your-service>7. Test Your Service<a class=headerlink href=#7-test-your-service title="Permanent link">&para;</a></h3> <div class="language-bash highlight"><pre><span></span><code><span id=__span-23-1><a id=__codelineno-23-1 name=__codelineno-23-1 href=#__codelineno-23-1></a><span class=c1># Deploy and test</span>
</span><span id=__span-23-2><a id=__codelineno-23-2 name=__codelineno-23-2 href=#__codelineno-23-2></a>make<span class=w> </span>deploy-quadlets
</span><span id=__span-23-3><a id=__codelineno-23-3 name=__codelineno-23-3 href=#__codelineno-23-3></a>
</span><span id=__span-23-4><a id=__codelineno-23-4 name=__codelineno-23-4 href=#__codelineno-23-4></a><span class=c1># Check service status</span>
</span><span id=__span-23-5><a id=__codelineno-23-5 name=__codelineno-23-5 href=#__codelineno-23-5></a>sudo<span class=w> </span>systemctl<span class=w> </span>status<span class=w> </span>flightctl-myservice.service
</span><span id=__span-23-6><a id=__codelineno-23-6 name=__codelineno-23-6 href=#__codelineno-23-6></a>
</span><span id=__span-23-7><a id=__codelineno-23-7 name=__codelineno-23-7 href=#__codelineno-23-7></a><span class=c1># View logs</span>
</span><span id=__span-23-8><a id=__codelineno-23-8 name=__codelineno-23-8 href=#__codelineno-23-8></a>sudo<span class=w> </span>journalctl<span class=w> </span>-u<span class=w> </span>flightctl-myservice.service<span class=w> </span>-f<span class=w> </span>--no-pager
</span></code></pre></div> <p>After sufficient testing, move onto the RPM steps below.</p> <h2 id=contributing-updating-the-rpm>Contributing: Updating the RPM<a class=headerlink href=#contributing-updating-the-rpm title="Permanent link">&para;</a></h2> <p>When adding new Quadlets to Flight Control, the RPM spec file needs to be updated to include the new service files in the <code>flightctl-services</code> sub-package. The spec file handles packaging and installation of Quadlet files through the system package manager.</p> <h3 id=1-update-the-files-services-section>1. Update the %files services Section<a class=headerlink href=#1-update-the-files-services-section title="Permanent link">&para;</a></h3> <p>Edit <code>packaging/rpm/flightctl.spec</code> to include your new service files. Add entries for both the configuration directory and any specific files:</p> <div class="language-text highlight"><pre><span></span><code><span id=__span-24-1><a id=__codelineno-24-1 name=__codelineno-24-1 href=#__codelineno-24-1></a>%files services
</span><span id=__span-24-2><a id=__codelineno-24-2 name=__codelineno-24-2 href=#__codelineno-24-2></a>    # ... existing content ...
</span><span id=__span-24-3><a id=__codelineno-24-3 name=__codelineno-24-3 href=#__codelineno-24-3></a>
</span><span id=__span-24-4><a id=__codelineno-24-4 name=__codelineno-24-4 href=#__codelineno-24-4></a>    # Add directory for dynamic config
</span><span id=__span-24-5><a id=__codelineno-24-5 name=__codelineno-24-5 href=#__codelineno-24-5></a>    %dir %{_sysconfdir}/flightctl/flightctl-myservice
</span><span id=__span-24-6><a id=__codelineno-24-6 name=__codelineno-24-6 href=#__codelineno-24-6></a>
</span><span id=__span-24-7><a id=__codelineno-24-7 name=__codelineno-24-7 href=#__codelineno-24-7></a>    # Add directory for read-only config
</span><span id=__span-24-8><a id=__codelineno-24-8 name=__codelineno-24-8 href=#__codelineno-24-8></a>    %dir %attr(0444,root,root) %{_datadir}/flightctl/flightctl-myservice
</span><span id=__span-24-9><a id=__codelineno-24-9 name=__codelineno-24-9 href=#__codelineno-24-9></a>
</span><span id=__span-24-10><a id=__codelineno-24-10 name=__codelineno-24-10 href=#__codelineno-24-10></a>    # Add specific config files (if any)
</span><span id=__span-24-11><a id=__codelineno-24-11 name=__codelineno-24-11 href=#__codelineno-24-11></a>    %{_datadir}/flightctl/flightctl-myservice/config.yaml.template
</span><span id=__span-24-12><a id=__codelineno-24-12 name=__codelineno-24-12 href=#__codelineno-24-12></a>    %{_datadir}/flightctl/flightctl-myservice/env.template
</span><span id=__span-24-13><a id=__codelineno-24-13 name=__codelineno-24-13 href=#__codelineno-24-13></a>    %attr(0755,root,root) %{_datadir}/flightctl/flightctl-myservice/init.sh
</span><span id=__span-24-14><a id=__codelineno-24-14 name=__codelineno-24-14 href=#__codelineno-24-14></a>
</span><span id=__span-24-15><a id=__codelineno-24-15 name=__codelineno-24-15 href=#__codelineno-24-15></a>    # Quadlet files are included via wildcard: %{_datadir}/containers/systemd/flightctl*
</span></code></pre></div> <h3 id=2-test-rpm-build>2. Test RPM Build<a class=headerlink href=#2-test-rpm-build title="Permanent link">&para;</a></h3> <p>Build the RPM locally:</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-25-1><a id=__codelineno-25-1 name=__codelineno-25-1 href=#__codelineno-25-1></a>rm<span class=w> </span>-rf<span class=w> </span>bin/rpm
</span><span id=__span-25-2><a id=__codelineno-25-2 name=__codelineno-25-2 href=#__codelineno-25-2></a>make<span class=w> </span>build<span class=w> </span>rpm
</span></code></pre></div> <p>The above will place the built services rpm in <code>bin/rpm/flightctl-services-*</code></p> <p>The rpm can be installed on the host system, or preferably a Fedora / CentOS Stream / RHEL VM.</p> <p>Install locally:</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-26-1><a id=__codelineno-26-1 name=__codelineno-26-1 href=#__codelineno-26-1></a>sudo<span class=w> </span>dnf<span class=w> </span>install<span class=w> </span>-y<span class=w> </span>bin/rpm/flightctl-services-*.rpm
</span></code></pre></div> <p>Install in a VM:</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-27-1><a id=__codelineno-27-1 name=__codelineno-27-1 href=#__codelineno-27-1></a><span class=c1># Sample command to move rpm file to VM</span>
</span><span id=__span-27-2><a id=__codelineno-27-2 name=__codelineno-27-2 href=#__codelineno-27-2></a>scp<span class=w> </span>-r<span class=w> </span>bin/rpm/flightctl-services-*<span class=w> </span>user@192.168.122.172:/home/user
</span><span id=__span-27-3><a id=__codelineno-27-3 name=__codelineno-27-3 href=#__codelineno-27-3></a>
</span><span id=__span-27-4><a id=__codelineno-27-4 name=__codelineno-27-4 href=#__codelineno-27-4></a><span class=c1># ssh into VM</span>
</span><span id=__span-27-5><a id=__codelineno-27-5 name=__codelineno-27-5 href=#__codelineno-27-5></a>
</span><span id=__span-27-6><a id=__codelineno-27-6 name=__codelineno-27-6 href=#__codelineno-27-6></a><span class=c1># Install RPM</span>
</span><span id=__span-27-7><a id=__codelineno-27-7 name=__codelineno-27-7 href=#__codelineno-27-7></a><span class=nb>cd</span><span class=w> </span>/home/user
</span><span id=__span-27-8><a id=__codelineno-27-8 name=__codelineno-27-8 href=#__codelineno-27-8></a>sudo<span class=w> </span>dnf<span class=w> </span>install<span class=w> </span>flightctl-services-*
</span></code></pre></div> <p>After installation services can be spun up by starting the <code>.target</code>:</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-28-1><a id=__codelineno-28-1 name=__codelineno-28-1 href=#__codelineno-28-1></a>sudo<span class=w> </span>systemctl<span class=w> </span>start<span class=w> </span>flightctl.target
</span></code></pre></div> </article> </div> <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> Back to top </button> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../metrics/ class="md-footer__link md-footer__link--prev" aria-label="Previous: Metrics"> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </div> <div class=md-footer__title> <span class=md-footer__direction> Previous </span> <div class=md-ellipsis> Metrics </div> </div> </a> <a href=../architecture/ class="md-footer__link md-footer__link--next" aria-label="Next: Architecture"> <div class=md-footer__title> <span class=md-footer__direction> Next </span> <div class=md-ellipsis> Architecture </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> </div> <div class=md-social> <a href=https://github.com/flightctl/flightctl target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <div class=md-progress data-md-component=progress role=progressbar></div> <script id=__config type=application/json>{"base": "../..", "features": ["announce.dismiss", "content.action.edit", "content.action.view", "content.code.annotate", "content.code.copy", "content.tabs.link", "content.tooltips", "header.autohide", "navigation.expand", "navigation.footer", "navigation.indexes", "navigation.instant", "navigation.instant.prefetch", "navigation.instant.progress", "navigation.prune", "navigation.sections", "navigation.tabs", "navigation.tabs.sticky", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest", "toc.follow"], "search": "../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script> <script src=../../assets/javascripts/bundle.56ea9cef.min.js></script> </body> </html>